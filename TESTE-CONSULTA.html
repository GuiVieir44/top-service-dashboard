<!DOCTYPE html>
<html>
<head>
    <title>TESTE CONSULTA PONTO</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f0f0f0; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; }
        h1 { color: #333; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
        button:hover { background: #0056b3; }
        select { width: 100%; padding: 10px; margin: 10px 0; font-size: 14px; }
        label { display: block; margin: 15px 0 5px 0; font-weight: bold; }
        .status { padding: 10px; background: #e8f5e9; border-left: 4px solid #4caf50; margin: 10px 0; border-radius: 4px; }
        .error { background: #ffebee; border-left-color: #f44336; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto; max-height: 300px; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ TESTE - Consulta de Ponto</h1>
        
        <div class="status">
            <strong>Status:</strong> <span id="status">Carregando...</span>
        </div>
        
        <button onclick="step1()">1Ô∏è‚É£ Carregar Dados Padr√£o</button>
        <button onclick="step2()">2Ô∏è‚É£ Inicializar M√≥dulo</button>
        <button onclick="checkStatus()">3Ô∏è‚É£ Verificar Status</button>
        <button onclick="clearAll()">üóëÔ∏è Limpar</button>
        
        <hr style="margin: 20px 0;">
        
        <label>Departamento:</label>
        <select id="punch-query-department-filter">
            <option>-- Carregando --</option>
        </select>
        
        <label>Funcion√°rio:</label>
        <select id="punch-query-employee-select">
            <option>-- Carregando --</option>
        </select>
        
        <h3>üìã Log:</h3>
        <pre id="log"></pre>
    </div>

    <script>
        let logMessages = [];
        
        function log(msg) {
            logMessages.push(msg);
            document.getElementById('log').textContent = logMessages.join('\n');
            console.log(msg);
            window.scrollTo(0, document.body.scrollHeight);
        }
        
        function clearLog() {
            logMessages = [];
            document.getElementById('log').textContent = '';
        }
        
        function setStatus(msg, isError = false) {
            const el = document.getElementById('status');
            el.textContent = msg;
            if (isError) {
                el.parentElement.classList.add('error');
            } else {
                el.parentElement.classList.remove('error');
            }
        }
        
        function step1() {
            clearLog();
            log('üì• PASSO 1: Carregando dados padr√£o...\n');
            
            const employees = [
                { id: 1, matricula: "MAT001", nome: "Ana Carolina Silva", departamento: "Condom√≠nio A" },
                { id: 2, matricula: "MAT002", nome: "Bruno Santos", departamento: "Condom√≠nio A" },
                { id: 3, matricula: "MAT003", nome: "Carla Mendes", departamento: "Condom√≠nio B" },
                { id: 4, matricula: "MAT004", nome: "Diego Ferreira", departamento: "Condom√≠nio B" },
                { id: 5, matricula: "MAT005", nome: "Elisa Rocha", departamento: "Transporte" }
            ];
            
            localStorage.setItem('topservice_employees_v1', JSON.stringify(employees));
            log(`‚úÖ ${employees.length} funcion√°rios salvos em localStorage`);
            log('‚úÖ Dados prontos para teste');
            setStatus('‚úÖ Dados carregados');
        }
        
        function step2() {
            clearLog();
            log('üöÄ PASSO 2: Inicializando m√≥dulo...\n');
            
            if (typeof initPunchQueryModule === 'function') {
                log('‚úÖ Fun√ß√£o initPunchQueryModule encontrada');
                try {
                    initPunchQueryModule();
                    log('‚úÖ initPunchQueryModule() executada com sucesso');
                    setStatus('‚úÖ M√≥dulo inicializado');
                    
                    setTimeout(() => {
                        checkStatus();
                    }, 100);
                } catch(err) {
                    log('‚ùå ERRO ao executar:', err.message);
                    setStatus('‚ùå Erro ao inicializar', true);
                }
            } else {
                log('‚ùå Fun√ß√£o initPunchQueryModule N√ÉO foi encontrada!');
                setStatus('‚ùå Fun√ß√£o n√£o encontrada', true);
            }
        }
        
        function checkStatus() {
            clearLog();
            log('üîç VERIFICANDO STATUS\n');
            
            const deptSelect = document.getElementById('punch-query-department-filter');
            const empSelect = document.getElementById('punch-query-employee-select');
            
            const deptOptions = deptSelect.options.length;
            const empOptions = empSelect.options.length;
            
            log(`üìä Departamento Select:`);
            log(`   - Encontrado: ‚úÖ`);
            log(`   - Options: ${deptOptions}`);
            if (deptOptions > 1) {
                log(`   - Valores: ${Array.from(deptSelect.options).map(o => o.value).join(', ')}`);
                log(`   - Labels: ${Array.from(deptSelect.options).map(o => o.text).join(', ')}`);
            }
            
            log(`\nüë§ Funcion√°rio Select:`);
            log(`   - Encontrado: ‚úÖ`);
            log(`   - Options: ${empOptions}`);
            if (empOptions > 1) {
                log(`   - Primeiras op√ß√µes:`);
                for (let i = 0; i < Math.min(5, empOptions); i++) {
                    log(`     - ${empSelect.options[i].text}`);
                }
            }
            
            if (deptOptions > 1 && empOptions > 1) {
                setStatus('‚úÖ TUDO OK - Selects preenchidos!');
                log('\nüéâ SUCESSO! Os selects est√£o preenchidos e prontos para uso.');
            } else {
                setStatus('‚ùå Problema - Selects n√£o preenchidos', true);
                log('\n‚ùå Os selects ainda est√£o vazios!');
            }
        }
        
        function clearAll() {
            clearLog();
            localStorage.clear();
            document.getElementById('punch-query-department-filter').innerHTML = '<option>-- Limpo --</option>';
            document.getElementById('punch-query-employee-select').innerHTML = '<option>-- Limpo --</option>';
            setStatus('üóëÔ∏è localStorage limpo');
            log('‚úÖ localStorage limpo e selects resetados');
        }
        
        // Verifica√ß√£o inicial
        window.addEventListener('load', function() {
            log('‚úÖ P√°gina carregada');
            log(`üì¶ initPunchQueryModule dispon√≠vel: ${typeof initPunchQueryModule === 'function' ? 'SIM' : 'N√ÉO'}`);
        });
    </script>

    <!-- Scripts necess√°rios -->
    <script src="scripts/data.js"></script>
    <script src="scripts/consulta-ponto.js"></script>
</body>
</html>
